WITH 
cci_2019 AS (
    SELECT
      Cds,
      RType,
      SchoolName,
      DistrictName,
      CountyName,
      CharterFlag,
      CoeFlag,
      DassFlag,
      SafetyNet,
      StudentGroup,
      CurrDenom,
      CurrStatus,
      PriorDenom,
      PriorStatus,
      Change,
      StatusLevel,
      ChangeLevel,
      Color,
      Box,
      CurrPrep,
      CurrPrepPct,
      CurrPrepSummative,
      CurrPrepSummativePct,
      CurrPrepApExam,
      CurrPrepApExamPct,
      CurrPrepIbExam,
      CurrPrepIbExamPct,
      CurrPrepCollegeCredit,
      CurrPrepCollegeCreditPct,
      CurrPrepAgPlus,
      CurrPrepAgPlusPct,
      CurrPrepCtePlus,
      CurrPrepCtePlusPct,
      CurrPrepSsb,
      CurrPrepSsbPct,
      CurrPrepMilSci,
      CurrPrepMilSciPct,
      CurrAPrep,
      CurrAPrepPct,
      CurrAPrepSummative,
      CurrAPrepSummativePct,
      CurrAPrepCollegeCredit,
      CurrAPrepCollegeCreditPct,
      CurrAPrepAg,
      CurrAPrepAgPct,
      CurrAPrepCte,
      CurrAPrepCtePct,
      CurrAPrepMilSci,
      CurrAPrepMilSciPct,
      CurrNPrep,
      CurrNPrepPct,
      PriorPrep,
      PriorPrepPct,
      PriorPrepSummative,
      PriorPrepSummativePct,
      PriorPrepApExam,
      PriorPrepApExamPct,
      PriorPrepIbExam,
      PriorPrepIbExamPct,
      PriorPrepCollegeCredit,
      PriorPrepCollegeCreditPct,
      PriorPrepAgPlus,
      PriorPrepAgPlusPct,
      PriorPrepCtePlus,
      PriorPrepCtePlusPct,
      PriorPrepSsb,
      PriorPrepSsbPct,
      PriorPrepMilSci,
      PriorPrepMilSciPct,
      PriorAPrep,
      PriorAPrepPct,
      PriorAPrepSummative,
      PriorAPrepSummativePct,
      PriorAPrepCollegeCredit,
      PriorAPrepCollegeCreditPct,
      PriorAPrepAg,
      PriorAPrepAgPct,
      PriorAPrepCte,
      PriorAPrepCtePct,
      PriorAPrepMilSci,
      PriorAPrepMilSciPct,
      PriorNPrep,
      PriorNPrepPct,
      ReportingYear
  FROM {{ ref('stg_RD__CaDashCci2019')}} 
  ),
  
  cci_2018 AS (
    SELECT
      Cds,
      RType,
      SchoolName,
      DistrictName,
      CountyName,
      CharterFlag,
      CoeFlag,
      DassFlag,
      CAST(NULL AS BOOL) AS SafetyNet,
      StudentGroup,
      CurrDenom,
      CurrStatus,
      PriorDenom,
      PriorStatus,
      Change,
      StatusLevel,
      ChangeLevel,
      Color,
      Box,
      CurrPrep,
      CurrPrepPct,
      CurrPrepSummative,
      CurrPrepSummativePct,
      CurrPrepApExam,
      CurrPrepApExamPct,
      CurrPrepIbExam,
      CurrPrepIbExamPct,
      CurrPrepCollegeCredit,
      CurrPrepCollegeCreditPct,
      CurrPrepAgPlus,
      CurrPrepAgPlusPct,
      CurrPrepCtePlus,
      CurrPrepCtePlusPct,
      CurrPrepSsb,
      CurrPrepSsbPct,
      CurrPrepMilSci,
      CurrPrepMilSciPct,
      CurrAPrep,
      CurrAPrepPct,
      CurrAPrepSummative,
      CurrAPrepSummativePct,
      CurrAPrepCollegeCredit,
      CurrAPrepCollegeCreditPct,
      CurrAPrepAg,
      CurrAPrepAgPct,
      CurrAPrepCte,
      CurrAPrepCtePct,
      CurrAPrepMilSci,
      CurrAPrepMilSciPct,
      CurrNPrep,
      CurrNPrepPct,
      PriorPrep,
      PriorPrepPct,
      PriorPrepSummative,
      PriorPrepSummativePct,
      PriorPrepApExam,
      PriorPrepApExamPct,
      PriorPrepIbExam,
      PriorPrepIbExamPct,
      PriorPrepCollegeCredit,
      PriorPrepCollegeCreditPct,
      PriorPrepAgPlus,
      PriorPrepAgPlusPct,
      PriorPrepCtePlus,
      PriorPrepCtePlusPct,
      PriorPrepSsb,
      PriorPrepSsbPct,
      PriorPrepMilSci,
      PriorPrepMilSciPct,
      PriorAPrep,
      PriorAPrepPct,
      PriorAPrepSummative,
      PriorAPrepSummativePct,
      PriorAPrepCollegeCredit,
      PriorAPrepCollegeCreditPct,
      PriorAPrepAg,
      PriorAPrepAgPct,
      PriorAPrepCte,
      PriorAPrepCtePct,
      PriorAPrepMilSci,
      PriorAPrepMilSciPct,
      PriorNPrep,
      PriorNPrepPct,
      ReportingYear
    FROM {{ ref('stg_RD__CaDashCci2018')}} 
  ),

  unioned AS (
    SELECT * FROM cci_2018
    UNION ALL
    SELECT * FROM cci_2019
  ),

  final AS (
    SELECT
      'College/Career' AS IndicatorName,
      CASE
        WHEN RType = 'X' THEN '00'
        WHEN RType = 'D' THEN SUBSTR(cds, 3, 5)
        WHEN RType = 'S' THEN SUBSTR(cds, LENGTH(cds)-6, 7)
      END AS EntityCode,
      *
    FROM unioned
  )

SELECT * FROM final
